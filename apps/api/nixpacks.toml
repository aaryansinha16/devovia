[phases.setup]
aptPkgs = ["nodejs", "git"]

[phases.install]
cmds = [
  "# Install dependencies",
  "npm install --legacy-peer-deps",
  "npm install prisma @prisma/client",
  
  "# Create minimal schema",
  "mkdir -p prisma",
  "echo 'generator client { provider = \"prisma-client-js\" }' > prisma/schema.prisma",
  "echo 'datasource db { provider = \"postgresql\" url = env(\"DATABASE_URL\") }' >> prisma/schema.prisma",
  
  "# Generate Prisma client",
  "npx prisma generate",
  
  "# Build the API",
  "npm run build"
]

[start]
cmd = "node dist/index.js"
