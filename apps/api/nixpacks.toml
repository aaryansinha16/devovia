[phases.setup]
aptPkgs = ["nodejs", "git"]

[phases.install]
cmds = [
  "# Clone just the database package to access the Prisma schema",
  "mkdir -p /tmp/database-package",
  "git clone --depth 1 https://github.com/aaryansinha16/devovia.git /tmp/repo",
  "cp -r /tmp/repo/packages/database /tmp/database-package",
  
  "# Install only the API dependencies without using workspace protocols",
  "npm install --legacy-peer-deps",
  
  "# Generate Prisma client from the shared schema",
  "mkdir -p node_modules/.prisma",
  "export DATABASE_URL=\"postgresql://placeholder:placeholder@localhost:5432/placeholder\" && cd /tmp/database-package/database && npx prisma generate",
  "cp -r /tmp/database-package/database/node_modules/.prisma node_modules/",
  
  "# Build the API",
  "npm run build"
]

[start]
cmd = "node dist/index.js"
