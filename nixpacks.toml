[phases.setup]
aptPkgs = ["git"]
nixPkgs = ["pnpm", "nodejs_22"]

[phases.install]
cmds = [
  "pnpm install --frozen-lockfile"
]

[phases.build]
cmds = [
  "cd packages/database && pnpm exec prisma generate",
  "cd packages/database && pnpm exec tsc",
  "cp -r packages/database/dist $(find node_modules/.pnpm -type d -path '*/file+packages+database*/node_modules/@repo/database' | head -n 1)/",
  "cd apps/api && pnpm exec prisma generate",
  "cd apps/api && pnpm exec tsc"
]

[start]
cmd = "bash /app/apps/api/scripts/start.sh"
